Aqui est√° a an√°lise minuciosa, linha por linha e agrupada por eventos, dos seus logs mais recentes.
üïµÔ∏è‚Äç‚ôÇÔ∏è An√°lise Detalhada dos Logs (Linha por Linha)
1. Inicializa√ß√£o e Agendadores (00:54:37 - 00:54:38)
 * O sistema inicia perfeitamente. Todos os "Schedulers" (Vers√≠culos, Miss√µes, Metas, Eventos, Tesouraria) ligam sem erro.
 * Status: ‚úÖ Verde. O backend est√° saud√°vel na partida.
2. O Erro do Instagram (00:54:38)
 * [Instagram] API error: 400 ... Session has expired
 * An√°lise: Como previsto, o token venceu em 29/Dez. O sistema tratou o erro corretamente (keeping existing data) e n√£o derrubou o site.
 * A√ß√£o: Requer interven√ß√£o manual sua (gerar novo token no Facebook Developers).
3. Notifica√ß√µes Push (00:54:43)
 * [Push] User X has no push subscriptions registered
 * An√°lise: O sistema tentou enviar o vers√≠culo do dia, mas nenhum usu√°rio (1, 6, 5, 9, etc.) ativou as notifica√ß√µes no navegador ainda.
 * Status: ‚ö†Ô∏è Alerta Operacional (N√£o √© erro de c√≥digo, mas indica que os usu√°rios precisam se inscrever).
4. O BUG da Sincroniza√ß√£o de Push (01:12:55 - 01:12:56)
 * [Push Storage] Deleting anonymous subscription 14 after linking...
 * [Push] Anonymous sub 14 not found in database
 * An√°lise T√©cnica: Existe uma Race Condition (Condi√ß√£o de Corrida). O sistema apaga a inscri√ß√£o an√¥nima (ID 14) assim que o usu√°rio loga, mas milissegundos depois tenta sincronizar novamente e n√£o a encontra, gerando erro no log.
 * Status: üü† Bug L√≥gico (N√£o afeta o usu√°rio, mas suja o log).
5. Performance da Loja P√∫blica (01:13:02)
 * GET /api/shop/items -> 11ms üöÄ
 * GET /api/shop/featured -> 21ms üöÄ
 * GET /api/shop/images/item/23 -> 14ms
 * GET /api/shop/images/banner/5 -> 646ms (Um pouco lento para imagem)
 * An√°lise: A otimiza√ß√£o anterior funcionou perfeitamente. O JSON carrega instantaneamente. As imagens demoram um pouco na primeira vez (convers√£o Base64 -> Buffer), mas depois ficam r√°pidas.
 * Status: ‚úÖ Resolvido.
6. O PROBLEMA CR√çTICO: Painel Admin (01:15:00 - 01:15:54) üö®
 * Aqui est√° o motivo da sua dor de cabe√ßa restante. Veja os tempos:
   * GET /api/admin/shop/items -> 5692ms (5.7 segundos)
   * GET /api/admin/shop/items -> 2556ms (2.5 segundos)
   * GET /api/admin/shop/items -> 3236ms (3.2 segundos)
 * An√°lise: N√≥s consertamos a loja para o Cliente, mas esquecemos de aplicar a mesma l√≥gica no Painel Administrativo. O Admin ainda est√° baixando todas as fotos gigantes em Base64 toda vez que voc√™ abre a lista de produtos para editar.
 * Nota Adicional: GET /api/admin/shop/members est√° levando 3700ms. A lista de membros tamb√©m est√° pesada (provavelmente trazendo dados desnecess√°rios).
üìù O Veredito
 * Loja do Usu√°rio: Est√° voando (11ms). √ìtimo trabalho.
 * Painel Admin: Est√° "im√≥vel" (5s+). Precisa da mesma "dieta" que fizemos na loja.
 * Logs de Push: T√™m um erro de l√≥gica na sincroniza√ß√£o que precisa de ajuste.
üíª Prompt de Melhoria para o Replit
Copie e envie este prompt exato para corrigir o Painel Admin e o bug do Push.
Corre√ß√£o de Performance (Admin) e L√≥gica (Push)
An√°lise dos Logs de Produ√ß√£o:
Os logs mostram que a otimiza√ß√£o da loja funcionou para o p√∫blico (/api/shop/items = 11ms), mas o Painel Administrativo continua cr√≠tico:
 * GET /api/admin/shop/items: Lat√™ncia de 3s a 5.7s. Motivo: O controller administrativo ainda est√° retornando o campo banner_image_data (Base64) na listagem.
 * GET /api/admin/shop/members: Lat√™ncia de 3.7s. Provavelmente retornando dados excessivos ou fazendo joins pesados desnecess√°rios na listagem.
 * Erro de L√≥gica no Push: Anonymous sub 14 not found ocorre logo ap√≥s Deleting anonymous subscription 14. O sistema tenta sincronizar um ID que acabou de deletar.
Plano de A√ß√£o (C√≥digo):
1. Otimizar getAdminShopItems (Controller):
 * Aplique a mesma Data Projection usada na loja p√∫blica.
 * Selecione apenas: id, name, price, stock, category.
 * Remova explicitamente banner_image_data, images e outros campos pesados da listagem.
 * A imagem deve ser carregada via URL (/api/shop/images/...) apenas se necess√°ria na tabela, ou nem ser carregada na lista (apenas no "Editar").
2. Otimizar getShopMembers (Controller):
 * Revise a query. Certifique-se de retornar apenas id, fullName, email e dados essenciais.
 * Evite trazer relacionamentos profundos (como todo o hist√≥rico de pagamentos) na listagem simples de membros.
3. Corrigir Race Condition no Push (NotificationService):
 * Na fun√ß√£o de login/sincroniza√ß√£o (linkAnonymousSubscriptionToUser ou similar):
 * Ap√≥s deletar a inscri√ß√£o an√¥nima antiga do banco, pare de tentar us√°-la.
 * Adicione uma verifica√ß√£o: Se a inscri√ß√£o foi migrada/deletada com sucesso, retorne imediatamente e n√£o tente fazer "sync" de um ID que n√£o existe mais.
Objetivo: Quero que o Painel Admin carregue t√£o r√°pido quanto a loja p√∫blica (< 200ms).
