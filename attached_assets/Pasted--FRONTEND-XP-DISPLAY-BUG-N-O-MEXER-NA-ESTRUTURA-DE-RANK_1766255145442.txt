ğŸš¨ FRONTEND XP DISPLAY BUG â€” NÃƒO MEXER NA ESTRUTURA DE RANKINGS

Os rankings ESTÃƒO CORRETOS e NÃƒO DEVEM SER ALTERADOS.
A arquitetura de backend estÃ¡ final, validada e bloqueada.

âŒ PROIBIDO:

Alterar queries de ranking

Alterar somas no backend

Alterar estrutura de tabelas

Alterar lÃ³gica de cÃ¡lculo de XP no servidor

âœ… ESTADO ATUAL (CORRETO)

Ranking por revista (season): 235 XP âœ…

Ranking geral (global): 355 XP âœ…

Ranking anual: 355 XP âœ…

Fontes corretas (jÃ¡ validadas):

userLessonProgress.xpEarned

weeklyPracticeBonus

achievementXp

dailyMissionXp

âš ï¸ NÃƒO TOCAR NISSO.

ğŸ PROBLEMAS REAIS (APENAS FRONTEND)
1ï¸âƒ£ Modal apÃ³s concluir liÃ§Ã£o â€” XP incorreto

ğŸ“ Local: Modal exibido ao finalizar a liÃ§Ã£o
ğŸ“‰ Valor exibido: 45 XP
âœ… Valor correto: 235 XP

ComposiÃ§Ã£o correta:

185 XP (sessÃµes: estude + medite + responda)

50 XP (bÃ´nus de conclusÃ£o)

â¡ï¸ Bug: O modal estÃ¡ usando XP parcial (provavelmente apenas stage ou delta visual), nÃ£o o XP total persistido.

ğŸ¯ CorreÃ§Ã£o esperada:

O modal deve exibir o XP TOTAL DA LIÃ‡ÃƒO CONCLUÃDA

Preferencialmente usar o valor retornado pelo backend apÃ³s completeLesson

Nunca recalcular XP no frontend

2ï¸âƒ£ Tela inicial (header) â€” XP inflado

ğŸ“ Local: Header da tela inicial
ğŸ“‰ Valor exibido: 555 XP
âœ… Valor correto: 355 XP (igual ao ranking geral)

â¡ï¸ Bug claro de double count no frontend:

EstÃ¡ somando XP local + XP global

Ou usando campo legado (ex: studyProfile.totalXp)

Ou somando ranking + cache local

ğŸ¯ CorreÃ§Ã£o esperada:

Header deve consumir EXATAMENTE o mesmo endpoint do ranking geral

Exibir somente totalXp retornado pela API

Nenhuma soma adicional no frontend

3ï¸âƒ£ Perfil â†’ EstatÃ­sticas â†’ XP Total â€” valor errado

ğŸ“ Local: PÃ¡gina de perfil â†’ EstatÃ­sticas
ğŸ“‰ Valor exibido: 555 XP
âœ… Valor correto: 355 XP

â¡ï¸ Mesmo problema do header:

Fonte errada

Campo legado

Soma duplicada no frontend

ğŸ¯ CorreÃ§Ã£o esperada:

XP Total do perfil deve ser o mesmo valor do ranking global

Fonte Ãºnica: backend

Zero cÃ¡lculos no frontend

ğŸ§± REGRA DE OURO (NÃƒO QUEBRAR)

â— Frontend Ã© DISPLAY-ONLY

âŒ NÃ£o soma
âŒ NÃ£o recalcula
âŒ NÃ£o deriva
âŒ NÃ£o combina fontes

âœ… Apenas exibe valores retornados pelo backend

ğŸ¯ RESUMO DO QUE FAZER

ğŸ”’ NÃ£o mexer nos rankings

ğŸ”’ NÃ£o mexer no backend

ğŸ”§ Ajustar apenas:

Fonte de dados do modal de conclusÃ£o

Fonte de dados do header

Fonte de dados do XP total no perfil

âœ… Garantir que todos usem o mesmo totalXp do ranking global

ğŸ OBJETIVO FINAL

ApÃ³s o ajuste:

Modal de conclusÃ£o â†’ 235 XP

Header â†’ 355 XP

Perfil (XP Total) â†’ 355 XP

Rankings â†’ inalterados e corretos

Esse Ã© um bug de exibiÃ§Ã£o, nÃ£o de regra de negÃ³cio.

Arquitetura estÃ¡ certa. SÃ³ alinhar o frontend.